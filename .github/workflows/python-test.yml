name: Run Python tests

on:
  - push
  - pull_request

jobs:
  test:
    runs-on: ubuntu-latest

    env:
      # Configure a constant location for the uv cache
      UV_CACHE_DIR: /tmp/.uv-cache

    steps:
    - uses: actions/checkout@v4
    - name: Install uv
      uses: astral-sh/setup-uv@v6
    - name: Restore cache
      uses: actions/cache@v4
      with:
        path: |
          /tmp/.uv-cache
          ~/.keras/datasets
        key: uv-${{ runner.os }}-${{ hashFiles('uv.lock') }}
        restore-keys: |
          uv-${{ runner.os }}-${{ hashFiles('uv.lock') }}
          uv-${{ runner.os }}
    - name: pytest
      run: uv run pytest
    - name: ruff check
      run: uv run ruff check --output-format=github
    - name: ruff format
      run: uv run ruff format --diff
    - name: Prune uv cache
      run: uv cache prune --ci
